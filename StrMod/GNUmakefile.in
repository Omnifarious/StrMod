# @configure_input@

prefix		=	@prefix@
exec_prefix	=	@exec_prefix@
srcdir		=	@srcdir@
top_srcdir	=	@top_srcdir@
libdir		=	$(prefix)/lib

CC = @CC@
CFLAGS = @CFLAGS@

CXX = @CXX@
CXXFLAGS = @CXXFLAGS@

CPPFLAGS = @CPPFLAGS@
DEFS =  @DEFS@

LDFLAGS = @LDFLAGS@
LIBS =  @LIBS@

DEPDB = @DEPDB@

%.o : %.cc
	$(CXX) -c $(@:.o=.cc) $(CPPFLAGS) $(CXXFLAGS) -o $@

%.s.o : %.cc
	$(CXX) -c $(@:.s.o=.cc) $(CPPFLAGS) $(CXXFLAGS) -fPIC -o $@

%.cc.d : %.cc
	+$(CXX) -c $< $(CPPFLAGS) $(CXXFLAGS) -M | sed "s;$<;;" | sed 's;^$(notdir $*)\.o;$*.cc;' | $(DEPDB) update --addtouch $< $<

%.c.d : %.c
	+$(CC) -c $< $(CPPFLAGS) $(CFLAGS) -M | sed "s;$<;;" | sed 's;^$(notdir $*)\.o;$*.c;' | $(DEPDB) update --addtouch $< $<

MYMAKE := $(MAKE)

# HL7Module.cc   StreambufModule.cc
CCNAMES = ChunkType.cc  StrChunkid.cc  EchoModule.cc  StrChunkio.cc \
          StrFDPlug.cc  STR_ClassIdent.cc  StreamFDModule.cc \
          SockListenModule.cc  StreamModule.cc  SocketModule.cc \
          StreamSplitter.cc  StrChunk.cc \
          tests/testchunk.cc  tests/server.cc  tests/testdist.cc \
          tests/testecho.cc  tests/teststr.cc  tests/echoserv.cc  

CNAMES = utils/cechoserv.c  utils/audiodiv.c  utils/writelots.c

#  StreambufModule.cc  HL7Module.cc
LIBCCS = ChunkType.cc  StrChunkid.cc  EchoModule.cc  StrChunkio.cc \
         StrFDPlug.cc  STR_ClassIdent.cc  StreamFDModule.cc \
         SockListenModule.cc  StreamModule.cc  SocketModule.cc \
         StreamSplitter.cc  StrChunk.cc

DEPSUB = $(patsubst %.c,%.o,$(?:.cc=.o))
DEPSUBDD = $(patsubst %.c,%.c.d,$(?:.cc=.cc.d))

$(libdir)/libStrMod.a : $(LIBCCS)
	$(MAKE) $(DEPSUB)
	ar rv $@ $(DEPSUB)
	rm -f $(DEPSUB)

$(EXTLIBTAG) : $(LIBCCS)
	$(MAKE) $(DEPSUB)
	touch $(EXTLIBTAG)
	ar rv $(EXTLIB) $(DEPSUB)
	rm -f $(DEPSUB)

tests/server : tests/server.o
	$(CXX) tests/server.o $(LDFALGS) -o tests/server

tests/echoserv : tests/echoserv.o
	$(CXX) tests/echoserv.o $(LDFLAGS) -o tests/echoserv

tests/testdist : tests/testdist.o
	$(CXX) tests/testdist.o $(LDFLAGS) -o tests/testdist

tests/teststr : tests/teststr.o
	$(CXX) tests/teststr.o $(LDFLAGS) -o tests/teststr

tests/testchunk : tests/testchunk.o
	$(CXX) tests/testchunk.o $(LDFLAGS) -o tests/testchunk

tests/testecho : tests/testecho.o
	$(CXX) tests/testecho.o $(LDFLAGS) -o tests/testecho 2>&1 | c++filt

GNUmakefile : depend.stamp
	$(DEPDB) list --makefiles GNUmakefile GNUmakefile.new
	mv GNUmakefile GNUmakefile~
	mv GNUmakefile.new GNUmakefile

depend.stamp : $(CCNAMES)
	rm -f GNUmakefile.old
	ln GNUmakefile GNUmakefile.old
	$(MYMAKE) -f GNUmakefile.old $(DEPSUBDD)
	rm -f GNUmakefile.old
	touch depend.stamp

##Do not delete this line, or the line after...
##Heh, heh, heh.

